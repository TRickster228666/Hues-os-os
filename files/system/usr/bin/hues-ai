#!/bin/bash
# HUES-AI: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ Ollama
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: gum, ollama, wl-clipboard

if ! pgrep -x "ollama" > /dev/null; then
    notify-send "HUES-AI" "–ó–∞–ø—É—Å–∫–∞—é Ollama..."
    ollama serve > /dev/null 2>&1 & disown
    sleep 2
fi

# –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –º–æ–¥–µ–ª—å (–∏–ª–∏ –≤–ø–∏—à–∏ —Å–≤–æ—é, –Ω–∞–ø—Ä. MODEL="llama3")
MODEL=$(ollama list | awk 'NR==2 {print $1}' | cut -d: -f1)
[ -z "$MODEL" ] && { gum style --foreground 196 "–ù–µ—Ç –º–æ–¥–µ–ª–µ–π Ollama!"; sleep 3; exit 1; }

# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
clear
gum style --foreground 212 --border double --padding "0 2" "ü§ñ HUES-AI ($MODEL)"
PROMPT=$(gum input --placeholder "–ù–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä: –û–±–Ω–æ–≤–∏ —Å–∏—Å—Ç–µ–º—É, –£—Å—Ç–∞–Ω–æ–≤–∏ Steam)...")
[ -z "$PROMPT" ] && exit 0

# –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
SYS_MSG="You are a Fedora Linux expert using Hyprland.
User Request: '$PROMPT'
Task: Output ONLY a single executable bash command.
Rules: No markdown, no quotes, no chat.
Preferred tools: dnf, flatpak, rpm-ostree, grim, nmcli.
If dangerous, echo 'I refuse'.
"

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
CMD=$(gum spin --title "–î—É–º–∞—é..." -- ollama run "$MODEL" "$SYS_MSG" | sed 's/`//g' | xargs)

# –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
gum style --foreground 212 "–ü—Ä–µ–¥–ª–∞–≥–∞—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å:"
gum style --foreground 255 --border rounded --padding "1 2" "$CMD"

if gum confirm "–í—ã–ø–æ–ª–Ω–∏—Ç—å?"; then
    echo "$CMD" | wl-copy
    eval "$CMD"
    gum style --foreground 70 "–ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏ Enter." && read
fi
